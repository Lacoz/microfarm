(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();const l={TILE_WIDTH:32,TILE_HEIGHT:16};function y(n,e,t,a,r,s,o,h){const u=n-t-r,c=e-a-s,i=Math.round((u/(l.TILE_WIDTH/2)+c/(l.TILE_HEIGHT/2))/2),d=Math.round((c/(l.TILE_HEIGHT/2)-u/(l.TILE_WIDTH/2))/2);return i>=0&&i<o&&d>=0&&d<h?{x:i,y:d}:null}function p(n,e,t,a,r,s){const o=t+(n-e)*l.TILE_WIDTH/2+r,h=a+(n+e)*l.TILE_HEIGHT/2+s;return{x:o,y:h}}class m{drawCharacter(e,t,a,r){const{bodyType:s,hairStyle:o,hairColor:h,skinTone:u}=r;e.fillStyle=u;let c=20,i=30;if(s==="slim"?(c=16,i=28):s==="sturdy"&&(c=24,i=32),e.fillRect(t-c/2,a-i,c,i),e.fillStyle=u,e.beginPath(),e.arc(t,a-i-15,15,0,Math.PI*2),e.fill(),e.fillStyle=h,o==="short")e.fillRect(t-12,a-i-25,24,8);else if(o==="long")e.fillRect(t-12,a-i-25,24,15);else if(o==="curly")for(let d=0;d<5;d++)e.beginPath(),e.arc(t-8+d*4,a-i-20+d%2*3,3,0,Math.PI*2),e.fill();e.fillStyle="#000",e.beginPath(),e.arc(t-5,a-i-18,2,0,Math.PI*2),e.arc(t+5,a-i-18,2,0,Math.PI*2),e.fill(),e.strokeStyle="#000",e.lineWidth=1,e.beginPath(),e.arc(t,a-i-8,3,0,Math.PI),e.stroke(),e.fillStyle=u,e.fillRect(t-c/2-8,a-i+5,6,20),e.fillRect(t+c/2+2,a-i+5,6,20),e.fillRect(t-c/2,a-5,6,25),e.fillRect(t+c/2-6,a-5,6,25)}}class g{constructor(){this.characterRenderer=new m,this.canvas=document.getElementById("game-canvas"),this.ctx=this.canvas.getContext("2d"),this.centerX=this.canvas.width/2,this.centerY=this.canvas.height/2}render(e){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.drawFarm(e.farm),this.drawPlayer(e.player,e.camera)}drawFarm(e){for(let t=0;t<e.height;t++)for(let a=0;a<e.width;a++){const r=e.tiles[t][a],s=p(a,t,this.centerX,this.centerY,0,0);s.x<-50||s.x>this.canvas.width+50||s.y<-50||s.y>this.canvas.height+50||this.drawTile(s.x,s.y,r)}}drawTile(e,t,a){const r={grass:"#90EE90",tilled:"#8B4513",watered:"#4169E1",planted:"#228B22"};let s=r[a.type];a.watered&&a.type==="tilled"&&(s=r.watered),a.planted&&(s=r.planted),this.ctx.fillStyle=s,this.ctx.strokeStyle="#2F4F2F",this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.moveTo(e,t-l.TILE_HEIGHT),this.ctx.lineTo(e+l.TILE_WIDTH/2,t),this.ctx.lineTo(e,t+l.TILE_HEIGHT),this.ctx.lineTo(e-l.TILE_WIDTH/2,t),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke(),a.planted&&a.growthStage>0&&this.drawCrop(e,t,a.growthStage)}drawCrop(e,t,a){const r=["#228B22","#32CD32","#FFD700"],s=r[Math.min(a-1,r.length-1)];this.ctx.fillStyle=s,this.ctx.beginPath(),this.ctx.arc(e,t-l.TILE_HEIGHT/2,3+a*2,0,Math.PI*2),this.ctx.fill()}drawPlayer(e,t){const a=this.centerX+t.x,r=this.centerY+t.y;this.characterRenderer.drawCharacter(this.ctx,a,r,e)}getTileAtScreenPosition(e,t,a){return y(e,t,this.centerX,this.centerY,a.camera.x,a.camera.y,a.farm.width,a.farm.height)}}class f{constructor(e,t){this.gameState=null,this.playerId=null,this.animationFrameId=null,this.cropUpdateInterval=null,this.apiService=e,this.uiManager=t,this.gameRenderer=new g}async startGame(e){try{const t=await this.apiService.createPlayer(e);this.gameState=t.gameState,this.playerId=t.player.id,this.uiManager.switchToGameScreen(),this.setupGameControls(),this.startGameLoop(),this.startCropUpdateInterval(),this.uiManager.updateGameUI(this.gameState)}catch(t){throw console.error("Failed to start game:",t),this.uiManager.showMessage("Failed to start game","error"),t}}setupGameControls(){if(!this.gameState)return;this.uiManager.setupToolButtons(t=>{this.gameState.game.currentTool=t}),this.uiManager.setupKeyboardControls(t=>{this.gameState.game.currentTool=t},t=>{this.moveCamera(t)});const e=document.getElementById("game-canvas");e.addEventListener("click",t=>{this.handleCanvasClick(t)}),e.addEventListener("mousemove",t=>{this.handleCanvasMouseMove(t)})}handleCanvasClick(e){if(!this.gameState||!this.playerId)return;const t=e.target.getBoundingClientRect(),a=e.clientX-t.left,r=e.clientY-t.top,s=this.gameRenderer.getTileAtScreenPosition(a,r,this.gameState);s&&this.useTool(s.x,s.y)}handleCanvasMouseMove(e){if(!this.gameState)return;const t=e.target.getBoundingClientRect(),a=e.clientX-t.left,r=e.clientY-t.top,s=this.gameRenderer.getTileAtScreenPosition(a,r,this.gameState),o=e.target;s?o.style.cursor="pointer":o.style.cursor="crosshair"}async useTool(e,t){if(!(!this.gameState||!this.playerId))try{const a=await this.apiService.useTool(this.playerId,this.gameState.game.currentTool,e,t);a.success?(this.gameState=a.gameState,this.uiManager.updateGameUI(this.gameState),a.harvestValue>0&&this.uiManager.showMessage(`Harvested! +$${a.harvestValue}`,"success")):this.uiManager.showMessage("Cannot use tool here","error")}catch(a){console.error("Failed to use tool:",a),this.uiManager.showMessage("Failed to use tool","error")}}async moveCamera(e){if(!this.gameState||!this.playerId)return;const t=10;let a={...this.gameState.camera};switch(e){case"up":a.y+=t;break;case"down":a.y-=t;break;case"left":a.x+=t;break;case"right":a.x-=t;break}try{const r={playerId:this.playerId,gameState:{camera:a}},s=await this.apiService.updateGameState(this.playerId,r);this.gameState=s.gameState}catch(r){console.error("Failed to move camera:",r)}}startGameLoop(){const e=()=>{this.gameState&&this.gameRenderer.render(this.gameState),this.animationFrameId=requestAnimationFrame(e)};e()}startCropUpdateInterval(){this.cropUpdateInterval=window.setInterval(async()=>{if(this.playerId)try{const e=await this.apiService.updateCrops(this.playerId);this.gameState=e.gameState}catch(e){console.error("Failed to update crops:",e)}},1e3)}stop(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.cropUpdateInterval&&(clearInterval(this.cropUpdateInterval),this.cropUpdateInterval=null)}}class w{constructor(){this.currentPlayer={name:"Farmer",bodyType:"average",hairStyle:"short",hairColor:"#8B4513",skinTone:"#FDBB7D"},this.characterRenderer=new m}init(e){this.setupEventListeners(e),this.updateCharacterPreview()}setupEventListeners(e){document.getElementById("farmer-name").addEventListener("input",r=>{this.currentPlayer.name=r.target.value||"Farmer",this.updateCharacterPreview()}),document.querySelectorAll("[data-body]").forEach(r=>{r.addEventListener("click",s=>{document.querySelectorAll("[data-body]").forEach(o=>o.classList.remove("active")),s.target.classList.add("active"),this.currentPlayer.bodyType=s.target.dataset.body,this.updateCharacterPreview()})}),document.querySelectorAll("[data-hair]").forEach(r=>{r.addEventListener("click",s=>{document.querySelectorAll("[data-hair]").forEach(o=>o.classList.remove("active")),s.target.classList.add("active"),this.currentPlayer.hairStyle=s.target.dataset.hair,this.updateCharacterPreview()})}),document.querySelectorAll("[data-color]").forEach(r=>{r.addEventListener("click",s=>{document.querySelectorAll("[data-color]").forEach(o=>o.classList.remove("active")),s.target.classList.add("active"),this.currentPlayer.hairColor=s.target.dataset.color,this.updateCharacterPreview()})}),document.querySelectorAll("[data-skin]").forEach(r=>{r.addEventListener("click",s=>{document.querySelectorAll("[data-skin]").forEach(o=>o.classList.remove("active")),s.target.classList.add("active"),this.currentPlayer.skinTone=s.target.dataset.skin,this.updateCharacterPreview()})}),document.getElementById("start-game-btn").addEventListener("click",async()=>{await this.startGame(e)})}updateCharacterPreview(){const e=document.getElementById("character-preview-canvas"),t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),this.characterRenderer.drawCharacter(t,100,150,this.currentPlayer)}async startGame(e){var t;if(!((t=this.currentPlayer.name)!=null&&t.trim())){alert("Please enter a name for your farmer!");return}try{const a={name:this.currentPlayer.name,bodyType:this.currentPlayer.bodyType,hairStyle:this.currentPlayer.hairStyle,hairColor:this.currentPlayer.hairColor,skinTone:this.currentPlayer.skinTone};await e.startGame(a)}catch(a){console.error("Failed to start game:",a),alert("Failed to start game. Please try again.")}}}class v{updateGameUI(e){const t=document.getElementById("player-name"),a=document.getElementById("day-counter"),r=document.getElementById("money"),s=document.getElementById("energy"),o=document.getElementById("seed-count");t&&(t.textContent=e.player.name),a&&(a.textContent=`Day ${e.game.day}`),r&&(r.textContent=`$${e.game.money}`),s&&(s.textContent=`Energy: ${e.game.energy}/${e.game.maxEnergy}`),o&&(o.textContent=e.game.seeds.toString())}switchToGameScreen(){const e=document.getElementById("character-creation"),t=document.getElementById("game-screen");e&&t&&(e.classList.remove("active"),t.classList.add("active"))}setActiveTool(e){document.querySelectorAll(".tool-btn").forEach(a=>{a.classList.remove("active")});const t=document.getElementById(`${e}-btn`);t&&t.classList.add("active")}showMessage(e,t="info"){const a=document.createElement("div");switch(a.className=`game-message ${t}`,a.textContent=e,a.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      z-index: 1000;
      animation: slideIn 0.3s ease-out;
    `,t){case"error":a.style.backgroundColor="#e74c3c";break;case"success":a.style.backgroundColor="#27ae60";break;default:a.style.backgroundColor="#3498db"}document.body.appendChild(a),setTimeout(()=>{a.style.animation="slideOut 0.3s ease-in",setTimeout(()=>{a.parentNode&&a.parentNode.removeChild(a)},300)},3e3)}setupToolButtons(e){document.querySelectorAll(".tool-btn").forEach(t=>{t.addEventListener("click",a=>{const r=a.target.id.replace("-btn","");this.setActiveTool(r),e(r)})})}setupKeyboardControls(e,t){document.addEventListener("keydown",a=>{switch(a.key.toLowerCase()){case"h":this.setActiveTool("hoe"),e("hoe");break;case"w":this.setActiveTool("water"),e("water");break;case"p":this.setActiveTool("plant"),e("plant");break;case"g":this.setActiveTool("harvest"),e("harvest");break;case"arrowup":t("up");break;case"arrowdown":case"s":t("down");break;case"arrowleft":case"a":t("left");break;case"arrowright":case"d":t("right");break}})}}class I{constructor(){this.baseUrl="/api"}async createPlayer(e){const t=await fetch(`${this.baseUrl}/players`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const r=await t.json();throw new Error(r.error||"Failed to create player")}return(await t.json()).data}async getPlayer(e){const t=await fetch(`${this.baseUrl}/players/${e}`);if(!t.ok){const r=await t.json();throw new Error(r.error||"Failed to get player")}return(await t.json()).data}async useTool(e,t,a,r){const s=await fetch(`${this.baseUrl}/players/${e}/use-tool`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tool:t,tileX:a,tileY:r})});if(!s.ok){const h=await s.json();throw new Error(h.error||"Failed to use tool")}return(await s.json()).data}async updateGameState(e,t){const a=await fetch(`${this.baseUrl}/players/${e}/game-state`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){const s=await a.json();throw new Error(s.error||"Failed to update game state")}return(await a.json()).data}async updateCrops(e){const t=await fetch(`${this.baseUrl}/players/${e}/update-crops`,{method:"POST"});if(!t.ok){const r=await t.json();throw new Error(r.error||"Failed to update crops")}return(await t.json()).data}}document.addEventListener("DOMContentLoaded",()=>{const n=new I,e=new w,t=new v,a=new f(n,t);e.init(a)});
//# sourceMappingURL=index-DQILYKZe.js.map
